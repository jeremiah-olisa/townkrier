<div class="section">
  <div class="section-header">
    <h2>Delivery Analysis</h2>
    <button class="btn btn-primary" onclick="location.reload()">Refresh</button>
  </div>
  
  <div class="alert alert-info">
    <strong>ðŸ“Š Analytics Overview</strong><br>
    This page shows delivery statistics and performance metrics for your notifications.
  </div>
</div>

<div class="stats-grid">
  <div class="stat-card">
    <h3>Total Notifications</h3>
    <div class="value"><%= stats.notifications.total %></div>
  </div>
  <div class="stat-card completed">
    <h3>Successfully Sent</h3>
    <div class="value"><%= stats.notifications.sent %></div>
  </div>
  <div class="stat-card failed">
    <h3>Failed</h3>
    <div class="value"><%= stats.notifications.failed %></div>
  </div>
  <div class="stat-card">
    <h3>Success Rate</h3>
    <div class="value">
      <%= stats.notifications.total > 0 ? Math.round((stats.notifications.sent / stats.notifications.total) * 100) : 0 %>%
    </div>
  </div>
</div>

<div class="section">
  <h2 style="margin-bottom: 20px;">By Channel</h2>
  
  <% if (Object.keys(stats.notifications.byChannel || {}).length === 0) { %>
    <div class="empty-state">
      <div class="empty-state-icon">ðŸ“Š</div>
      <h3>No channel data available</h3>
      <p>Send notifications to see channel breakdown</p>
    </div>
  <% } else { %>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
      <% Object.entries(stats.notifications.byChannel || {}).forEach(([channel, count]) => { %>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea;">
          <h3 style="color: #7f8c8d; font-size: 14px; margin-bottom: 8px; text-transform: uppercase;">
            <%= channel %>
          </h3>
          <div style="font-size: 32px; font-weight: 700; color: #2c3e50;">
            <%= count %>
          </div>
        </div>
      <% }); %>
    </div>
  <% } %>
</div>

<div class="section">
  <h2 style="margin-bottom: 20px;">By Status</h2>
  
  <% if (Object.keys(stats.notifications.byStatus || {}).length === 0) { %>
    <div class="empty-state">
      <div class="empty-state-icon">ðŸ“ˆ</div>
      <h3>No status data available</h3>
      <p>Send notifications to see status breakdown</p>
    </div>
  <% } else { %>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
      <% Object.entries(stats.notifications.byStatus || {}).forEach(([status, count]) => { %>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid <%= status === 'sent' ? '#27ae60' : status === 'failed' ? '#e74c3c' : '#3498db' %>;">
          <h3 style="color: #7f8c8d; font-size: 14px; margin-bottom: 8px; text-transform: uppercase;">
            <%= status %>
          </h3>
          <div style="font-size: 32px; font-weight: 700; color: #2c3e50;">
            <%= count %>
          </div>
        </div>
      <% }); %>
    </div>
  <% } %>
</div>

<div class="section">
  <h2 style="margin-bottom: 20px;">Queue Performance</h2>
  
  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
      <h3 style="color: #7f8c8d; font-size: 14px; margin-bottom: 8px;">Pending Jobs</h3>
      <div style="font-size: 32px; font-weight: 700; color: #3498db;">
        <%= stats.queue.pending %>
      </div>
    </div>
    
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
      <h3 style="color: #7f8c8d; font-size: 14px; margin-bottom: 8px;">Processing Jobs</h3>
      <div style="font-size: 32px; font-weight: 700; color: #f39c12;">
        <%= stats.queue.processing %>
      </div>
    </div>
    
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
      <h3 style="color: #7f8c8d; font-size: 14px; margin-bottom: 8px;">Completed Jobs</h3>
      <div style="font-size: 32px; font-weight: 700; color: #27ae60;">
        <%= stats.queue.completed %>
      </div>
    </div>
    
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
      <h3 style="color: #7f8c8d; font-size: 14px; margin-bottom: 8px;">Failed Jobs</h3>
      <div style="font-size: 32px; font-weight: 700; color: #e74c3c;">
        <%= stats.queue.failed %>
      </div>
    </div>
    
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
      <h3 style="color: #7f8c8d; font-size: 14px; margin-bottom: 8px;">Scheduled Jobs</h3>
      <div style="font-size: 32px; font-weight: 700; color: #9b59b6;">
        <%= stats.queue.scheduled %>
      </div>
    </div>
    
    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
      <h3 style="color: #7f8c8d; font-size: 14px; margin-bottom: 8px;">Job Success Rate</h3>
      <div style="font-size: 32px; font-weight: 700; color: #2c3e50;">
        <%= (stats.queue.completed + stats.queue.failed) > 0 ? Math.round((stats.queue.completed / (stats.queue.completed + stats.queue.failed)) * 100) : 0 %>%
      </div>
    </div>
  </div>
</div>

<script>
  // Auto-refresh every 10 seconds
  setTimeout(() => {
    location.reload();
  }, 10000);
</script>
